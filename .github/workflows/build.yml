name: Build

on: push

jobs:
  toolchain:
    name: Toolchain

    runs-on: ubuntu-18.04

    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          path: main

      - name: Checkout LLVM
        uses: actions/checkout@v2
        with:
          repository: llvm/llvm-project
          ref: llvmorg-11.0.1
          path: llvm-project

      - name: Build LLVM
        run: |
          cd llvm-project
          ls -la
          cmake \
            -DLLVM_TARGETS_TO_BUILD=ARM \
            -DLLVM_DEFAULT_TARGET_TRIPLE=arm-linux-gnueabihf \
            -DCMAKE_BUILD_TYPE=Release \
            -DCMAKE_INSTALL_PREFIX=$GITHUB_WORKSPACE/toolchain \
            ../llvm
          make -j `nproc`
          make install

      - name: Build Clang
        run: |
          cmake \
            -DLLVM_TARGETS_TO_BUILD=ARM \
            -DLLVM_DEFAULT_TARGET_TRIPLE=arm-linux-gnueabihf \
            -DCMAKE_BUILD_TYPE=Release \
            -DCMAKE_INSTALL_PREFIX=$GITHUB_WORKSPACE/toolchain \
            ../clang
          make -j `nproc`
          make install
